{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://trafficprediction.com/schemas/traffic-prediction.json",
  "title": "Traffic Prediction",
  "description": "Schema for traffic predictions generated by ML models and published to traffic-predictions topic (Task 7.3)",
  "type": "object",
  "required": ["prediction_id", "segment_id", "prediction_timestamp", "prediction_horizon", "predicted_speed", "predicted_volume", "confidence_score", "model_version"],
  "properties": {
    "prediction_id": {
      "type": "string",
      "description": "Unique identifier for the traffic prediction",
      "pattern": "^PRED_[A-Za-z0-9_-]+$",
      "minLength": 6,
      "maxLength": 64
    },
    "segment_id": {
      "type": "string",
      "description": "Road segment identifier for the prediction",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 32
    },
    "prediction_timestamp": {
      "type": "integer",
      "description": "Time when the prediction was generated (epoch milliseconds)",
      "minimum": 1000000000000,
      "maximum": 9999999999999
    },
    "prediction_horizon": {
      "type": "integer",
      "description": "Prediction horizon in minutes from current time",
      "minimum": 1,
      "maximum": 1440
    },
    "target_timestamp": {
      "type": "integer",
      "description": "Target time for the prediction (epoch milliseconds)",
      "minimum": 1000000000000,
      "maximum": 9999999999999
    },
    "predicted_speed": {
      "type": "number",
      "description": "Predicted average speed (km/h)",
      "minimum": 0,
      "maximum": 200
    },
    "predicted_volume": {
      "type": ["integer", "null"],
      "description": "Predicted vehicle volume",
      "minimum": 0,
      "maximum": 10000
    },
    "predicted_occupancy": {
      "type": ["number", "null"],
      "description": "Predicted occupancy percentage (0-100)",
      "minimum": 0,
      "maximum": 100
    },
    "predicted_congestion_level": {
      "type": "string",
      "description": "Predicted congestion level",
      "enum": ["FREE_FLOW", "LIGHT", "MODERATE", "HEAVY", "SEVERE"]
    },
    "confidence_score": {
      "type": "number",
      "description": "Confidence score for the prediction (0-1)",
      "minimum": 0,
      "maximum": 1
    },
    "uncertainty_bounds": {
      "type": "object",
      "description": "Uncertainty bounds for the prediction",
      "properties": {
        "speed_lower": {
          "type": ["number", "null"],
          "description": "Lower bound for speed prediction (km/h)",
          "minimum": 0,
          "maximum": 200
        },
        "speed_upper": {
          "type": ["number", "null"],
          "description": "Upper bound for speed prediction (km/h)",
          "minimum": 0,
          "maximum": 200
        },
        "volume_lower": {
          "type": ["integer", "null"],
          "description": "Lower bound for volume prediction",
          "minimum": 0,
          "maximum": 10000
        },
        "volume_upper": {
          "type": ["integer", "null"],
          "description": "Upper bound for volume prediction",
          "minimum": 0,
          "maximum": 10000
        }
      },
      "additionalProperties": false
    },
    "model_version": {
      "type": "string",
      "description": "Version of the ML model used for prediction",
      "pattern": "^v\\d+\\.\\d+\\.\\d+$",
      "minLength": 5,
      "maxLength": 20
    },
    "model_type": {
      "type": "string",
      "description": "Type of ML model used",
      "enum": ["LINEAR_REGRESSION", "RANDOM_FOREST", "NEURAL_NETWORK", "LSTM", "ARIMA", "ENSEMBLE"]
    },
    "features_used": {
      "type": "array",
      "description": "List of features used by the model",
      "items": {
        "type": "string",
        "enum": [
          "HISTORICAL_SPEED",
          "HISTORICAL_VOLUME", 
          "TIME_OF_DAY",
          "DAY_OF_WEEK",
          "WEATHER",
          "INCIDENTS",
          "EVENTS",
          "SEASONAL",
          "OCCUPANCY",
          "ADJACENT_SEGMENTS"
        ]
      },
      "minItems": 1,
      "maxItems": 20
    },
    "coordinates": {
      "type": "object",
      "description": "Geographic coordinates for the prediction",
      "required": ["latitude", "longitude"],
      "properties": {
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate",
          "minimum": -90,
          "maximum": 90
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate",
          "minimum": -180,
          "maximum": 180
        }
      },
      "additionalProperties": false
    },
    "historical_context": {
      "type": "object",
      "description": "Historical context used for the prediction",
      "properties": {
        "avg_speed_1h": {
          "type": ["number", "null"],
          "description": "Average speed in the past hour (km/h)"
        },
        "avg_speed_24h": {
          "type": ["number", "null"],
          "description": "Average speed in the past 24 hours (km/h)"
        },
        "avg_speed_7d": {
          "type": ["number", "null"],
          "description": "Average speed in the past 7 days (km/h)"
        },
        "similar_conditions": {
          "type": ["integer", "null"],
          "description": "Number of similar historical conditions used"
        }
      },
      "additionalProperties": false
    },
    "external_factors": {
      "type": "object",
      "description": "External factors considered in the prediction",
      "properties": {
        "weather_impact": {
          "type": ["number", "null"],
          "description": "Weather impact factor (-1 to 1)"
        },
        "event_impact": {
          "type": ["number", "null"],
          "description": "Special event impact factor (-1 to 1)"
        },
        "incident_nearby": {
          "type": ["boolean", "null"],
          "description": "Whether there are incidents in nearby segments"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "prediction_id": "PRED_20250919_1400_001",
      "segment_id": "SEG_I405_N_001",
      "prediction_timestamp": 1726750800000,
      "prediction_horizon": 15,
      "target_timestamp": 1726751700000,
      "predicted_speed": 42.5,
      "predicted_volume": 580,
      "predicted_occupancy": 35.2,
      "predicted_congestion_level": "MODERATE",
      "confidence_score": 0.87,
      "uncertainty_bounds": {
        "speed_lower": 38.1,
        "speed_upper": 46.9,
        "volume_lower": 520,
        "volume_upper": 640
      },
      "model_version": "v2.1.3",
      "model_type": "LSTM",
      "features_used": [
        "HISTORICAL_SPEED",
        "HISTORICAL_VOLUME",
        "TIME_OF_DAY",
        "DAY_OF_WEEK",
        "WEATHER"
      ],
      "coordinates": {
        "latitude": 34.0522,
        "longitude": -118.2437
      },
      "historical_context": {
        "avg_speed_1h": 45.2,
        "avg_speed_24h": 52.8,
        "avg_speed_7d": 49.6,
        "similar_conditions": 142
      },
      "external_factors": {
        "weather_impact": -0.1,
        "event_impact": 0.0,
        "incident_nearby": false
      }
    }
  ]
}