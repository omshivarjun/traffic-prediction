{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://trafficprediction.com/schemas/traffic-raw-event.json",
  "title": "Traffic Raw Event",
  "description": "Schema for raw traffic events from sensors published to traffic-raw topic (Task 7.3)",
  "type": "object",
  "required": ["event_id", "segment_id", "timestamp", "coordinates", "source", "quality_score"],
  "properties": {
    "event_id": {
      "type": "string",
      "description": "Unique identifier for the traffic event",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 64
    },
    "segment_id": {
      "type": "string", 
      "description": "Identifier for the road segment where the event occurred",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 32
    },
    "timestamp": {
      "type": "integer",
      "description": "Time when the event was recorded (epoch milliseconds)",
      "minimum": 1000000000000,
      "maximum": 9999999999999
    },
    "speed": {
      "type": ["number", "null"],
      "description": "Average speed of vehicles in km/h",
      "minimum": 0,
      "maximum": 200
    },
    "volume": {
      "type": ["integer", "null"],
      "description": "Number of vehicles detected in the time window",
      "minimum": 0,
      "maximum": 10000
    },
    "occupancy": {
      "type": ["number", "null"], 
      "description": "Percentage of time the sensor detected a vehicle (0-100)",
      "minimum": 0,
      "maximum": 100
    },
    "coordinates": {
      "type": "object",
      "description": "Geographic coordinates of the event",
      "required": ["latitude", "longitude"],
      "properties": {
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate",
          "minimum": -90,
          "maximum": 90
        },
        "longitude": {
          "type": "number", 
          "description": "Longitude coordinate",
          "minimum": -180,
          "maximum": 180
        }
      },
      "additionalProperties": false
    },
    "source": {
      "type": "string",
      "description": "Source of the traffic event data",
      "enum": ["SENSOR", "CAMERA", "PROBE", "INCIDENT_REPORT", "WEATHER_STATION"]
    },
    "quality_score": {
      "type": "number",
      "description": "Data quality score between 0 and 1",
      "minimum": 0,
      "maximum": 1
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the event",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]*$": {
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "event_id": "EVT_20250919_001",
      "segment_id": "SEG_I405_N_001", 
      "timestamp": 1726750800000,
      "speed": 65.5,
      "volume": 120,
      "occupancy": 15.2,
      "coordinates": {
        "latitude": 34.0522,
        "longitude": -118.2437
      },
      "source": "SENSOR",
      "quality_score": 0.95,
      "metadata": {
        "sensor_type": "loop_detector",
        "lane_count": "3"
      }
    }
  ]
}